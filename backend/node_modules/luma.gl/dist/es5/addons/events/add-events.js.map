{"version":3,"sources":["../../../../src/addons/events/add-events.js"],"names":["noop","KEYS","enter","up","down","left","right","esc","space","backspace","tab","delete","toO3D","n","_getPos","elem","bbox","getBoundingClientRect","x","y","top","get","e","win","window","event","getWheel","wheelDelta","detail","getKey","code","which","keyCode","key","keyOf","fKey","String","fromCharCode","toLowerCase","shift","shiftKey","control","ctrlKey","alt","altKey","meta","metaKey","isRightClick","button","getPos","doc","document","documentElement","body","touches","length","touchesPos","l","evt","i","push","pageX","clientX","scrollLeft","pageY","clientY","scrollTop","page","stop","stopPropagation","cancelBubble","preventDefault","returnValue","EventsProxy","domElem","opt","scene","pos","callbacks","size","width","offsetWidth","height","offsetHeight","attachEvents","disableContextMenu","oncontextmenu","enableMouse","forEach","action","addEventListener","eventInfo","type","getBoxObjectFor","mozInnerScreenX","enableTouch","enableKeyboard","getSize","relative","centerOrigin","cachePosition","ge","epos","origPos","wheel","Object","assign","cacheTarget","posArray","cache","getTarget","picking","pick","cacheSize","moved","onRightClick","hovered","onClick","pressed","onDragEnd","onDragCancel","rt","relatedTarget","parentNode","onMouseLeave","onDragMove","target","hash","onMouseEnter","onMouseMove","onMouseWheel","onDragStart","touched","touchedLastPosition","onTouchStart","touchMoved","onTouchMove","onTouchEnd","isNaN","onTap","onTouchCancel","onKeyDown","onKeyUp","prototype","DEFAULT_OPTS","bind","Keys","keyMap","name","addEvents","domElement","match","fname","fn","f","apply","Array","slice","call","arguments","removeEvents"],"mappings":"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","sourcesContent":["// event.js\n// Handle keyboard/mouse/touch events in the Canvas\n// TODO - this will not work under node\n\n/* eslint-disable dot-notation, max-statements, no-loop-func */\n/* global window, document */\nfunction noop() {}\n\nconst KEYS = {\n  enter: 13,\n  up: 38,\n  down: 40,\n  left: 37,\n  right: 39,\n  esc: 27,\n  space: 32,\n  backspace: 8,\n  tab: 9,\n  delete: 46\n};\n\n// returns an O3D object or false otherwise.\nfunction toO3D(n) {\n  return n !== true ? n : false;\n}\n\n// Returns an element position\nfunction _getPos(elem) {\n  const bbox = elem.getBoundingClientRect();\n  return {\n    x: bbox.left,\n    y: bbox.top,\n    bbox\n  };\n}\n\n// event object wrapper\nexport function get(e, win) {\n  win = win || window;\n  return e || win.event;\n}\n\nexport function getWheel(e) {\n  return e.wheelDelta ? e.wheelDelta / 120 : -(e.detail || 0) / 3;\n}\n\nexport function getKey(e) {\n  const code = e.which || e.keyCode;\n  let key = keyOf(code);\n  // onkeydown\n  const fKey = code - 111;\n  if (fKey > 0 && fKey < 13) {\n    key = `f${fKey}`;\n  }\n  key = key || String.fromCharCode(code).toLowerCase();\n\n  return {\n    code,\n    key,\n    shift: e.shiftKey,\n    control: e.ctrlKey,\n    alt: e.altKey,\n    meta: e.metaKey\n  };\n}\n\nexport function isRightClick(e) {\n  return e.which === 3 || e.button === 2;\n}\n\nexport function getPos(e, win) {\n  // get mouse position\n  win = win || window;\n  e = e || win.event;\n  let doc = win.document;\n  doc = doc.documentElement || doc.body;\n  // TODO(nico): make touch event handling better\n  if (e.touches && e.touches.length) {\n    const touchesPos = [];\n    const l = e.touches.length;\n    let evt;\n    for (let i = 0; i < l; ++i) {\n      evt = e.touches[i];\n      touchesPos.push({\n        x: evt.pageX || (evt.clientX + doc.scrollLeft),\n        y: evt.pageY || (evt.clientY + doc.scrollTop)\n      });\n    }\n    return touchesPos;\n  }\n  const page = {\n    x: e.pageX || (e.clientX + doc.scrollLeft),\n    y: e.pageY || (e.clientY + doc.scrollTop)\n  };\n  return [page];\n}\n\nexport function stop(e) {\n  if (e.stopPropagation) {\n    e.stopPropagation();\n  }\n  e.cancelBubble = true;\n  if (e.preventDefault) {\n    e.preventDefault();\n  } else {\n    e.returnValue = false;\n  }\n}\n\nexport class EventsProxy {\n\n  constructor(domElem, opt) {\n    this.scene = opt.scene;\n    this.domElem = domElem;\n    this.pos = _getPos(domElem);\n    this.opt = this.callbacks = opt;\n\n    this.size = {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n\n    this.attachEvents();\n  }\n\n  attachEvents() {\n    const domElem = this.domElem;\n    const opt = this.opt;\n\n    if (opt.disableContextMenu) {\n      domElem.oncontextmenu = () => false;\n    }\n\n    if (opt.enableMouse) {\n      ['mouseup', 'mousedown', 'mousemove', 'mouseover', 'mouseout']\n      .forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n\n      // \"well, this is embarrassing...\"\n      let type = '';\n      if (!document.getBoxObjectFor && window.mozInnerScreenX === null) {\n        type = 'mousewheel';\n      } else {\n        type = 'DOMMouseScroll';\n      }\n      domElem.addEventListener(type, (e, win) => {\n        this['mousewheel'](this.eventInfo('mousewheel', e, win));\n      }, false);\n    }\n\n    if (opt.enableTouch) {\n      ['touchstart', 'touchmove', 'touchend'].forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n\n    if (opt.enableKeyboard) {\n      ['keydown', 'keyup'].forEach(action => {\n        document.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n  }\n\n  eventInfo(type, e, win) {\n    const domElem = this.domElem;\n    const scene = this.scene;\n    const opt = this.opt;\n    const size = this.getSize();\n    const relative = opt.relative;\n    const centerOrigin = opt.centerOrigin;\n    const pos = opt.cachePosition && this.pos || _getPos(domElem);\n    const ge = get(e, win);\n    const epos = getPos(e, win);\n    const origPos = {x: epos[0].x, y: epos[0].y};\n    const evt = {};\n    let x;\n    let y;\n\n    // get Position\n    for (let i = 0, l = epos.length; i < l; ++i) {\n      x = epos[i].x;\n      y = epos[i].y;\n      if (relative) {\n        x -= pos.x; y -= pos.y;\n        if (centerOrigin) {\n          x -= size.width / 2;\n          y -= size.height / 2;\n          // y axis now points to the top of the screen\n          y *= -1;\n        }\n      }\n      epos[i].x = x;\n      epos[i].y = y;\n    }\n\n    switch (type) {\n    case 'mousewheel':\n      evt.wheel = getWheel(ge);\n      break;\n    case 'keydown':\n    case 'keyup':\n      Object.assign(evt, getKey(ge));\n      break;\n    case 'mouseup':\n      evt.isRightClick = isRightClick(ge);\n      break;\n    default:\n      break;\n    }\n\n    let cacheTarget;\n\n    Object.assign(evt, {\n      x: epos[0].x,\n      y: epos[0].y,\n      posArray: epos,\n\n      cache: false,\n      // stop event propagation\n      stop() {\n        stop(ge);\n      },\n      // get the target element of the event\n      getTarget() {\n        if (cacheTarget) {\n          return cacheTarget;\n        }\n        return (cacheTarget = opt.picking &&\n          scene.pick(origPos.x - pos.x, origPos.y - pos.y) || true);\n      }\n    });\n    // wrap native event\n    evt.event = ge;\n\n    return evt;\n  }\n\n  getSize() {\n    if (this.cacheSize) {\n      return this.size;\n    }\n    const domElem = this.domElem;\n    return {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n  }\n\n  mouseup(e) {\n    if (!this.moved) {\n      if (e.isRightClick) {\n        this.callbacks.onRightClick(e, this.hovered);\n      } else {\n        this.callbacks.onClick(e, toO3D(this.pressed));\n      }\n    }\n    if (this.pressed) {\n      if (this.moved) {\n        this.callbacks.onDragEnd(e, toO3D(this.pressed));\n      } else {\n        this.callbacks.onDragCancel(e, toO3D(this.pressed));\n      }\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseout(e) {\n    // mouseout canvas\n    let rt = e.relatedTarget;\n    const domElem = this.domElem;\n    while (rt && rt.parentNode) {\n      if (domElem === rt.parentNode) {\n        return;\n      }\n      rt = rt.parentNode;\n    }\n    if (this.hovered) {\n      this.callbacks.onMouseLeave(e, this.hovered);\n      this.hovered = false;\n    }\n    if (this.pressed && this.moved) {\n      this.callbacks.onDragEnd(e);\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseover(e) {\n  }\n\n  mousemove(e) {\n    if (this.pressed) {\n      this.moved = true;\n      this.callbacks.onDragMove(e, toO3D(this.pressed));\n      return;\n    }\n    if (this.hovered) {\n      const target = toO3D(e.getTarget());\n      if (!target || target.hash !== this.hash) {\n        this.callbacks.onMouseLeave(e, this.hovered);\n        this.hovered = target;\n        this.hash = target;\n        if (target) {\n          this.hash = target.hash;\n          this.callbacks.onMouseEnter(e, this.hovered);\n        }\n      } else {\n        this.callbacks.onMouseMove(e, this.hovered);\n      }\n    } else {\n      this.hovered = toO3D(e.getTarget());\n      this.hash = this.hovered;\n      if (this.hovered) {\n        this.hash = this.hovered.hash;\n        this.callbacks.onMouseEnter(e, this.hovered);\n      }\n    }\n    if (!this.opt.picking) {\n      this.callbacks.onMouseMove(e);\n    }\n  }\n\n  mousewheel(e) {\n    this.callbacks.onMouseWheel(e);\n  }\n\n  mousedown(e) {\n    this.pressed = e.getTarget();\n    this.callbacks.onDragStart(e, toO3D(this.pressed));\n  }\n\n  touchstart(e) {\n    this.touched = e.getTarget();\n    this.touchedLastPosition = {x: e.x, y: e.y};\n    this.callbacks.onTouchStart(e, toO3D(this.touched));\n  }\n\n  touchmove(e) {\n    if (this.touched) {\n      this.touchMoved = true;\n      this.callbacks.onTouchMove(e, toO3D(this.touched));\n    }\n  }\n\n  touchend(e) {\n    if (this.touched) {\n      if (this.touchMoved) {\n        this.callbacks.onTouchEnd(e, toO3D(this.touched));\n      } else {\n        e.x = isNaN(e.x) ? this.touchedLastPosition.x : e.x;\n        e.y = isNaN(e.y) ? this.touchedLastPosition.y : e.y;\n        this.callbacks.onTap(e, toO3D(this.touched));\n        this.callbacks.onTouchCancel(e, toO3D(this.touched));\n      }\n      this.touched = this.touchMoved = false;\n    }\n  }\n\n  keydown(e) {\n    this.callbacks.onKeyDown(e);\n  }\n\n  keyup(e) {\n    this.callbacks.onKeyUp(e);\n  }\n}\n\nObject.assign(EventsProxy.prototype, {\n  hovered: false,\n  pressed: false,\n  touched: false,\n  touchedLastPosition: {x: 0, y: 0},\n  touchMoved: false,\n  moved: false\n});\n\nconst DEFAULT_OPTS = {\n  cachePosition: true,\n  cacheSize: true,\n  relative: true,\n  centerOrigin: true,\n  disableContextMenu: true,\n  bind: false,\n  picking: false,\n\n  enableTouch: true,\n  enableMouse: true,\n  enableKeyboard: true,\n\n  onClick: noop,\n  onRightClick: noop,\n  onDragStart: noop,\n  onDragMove: noop,\n  onDragEnd: noop,\n  onDragCancel: noop,\n  onTouchStart: noop,\n  onTouchMove: noop,\n  onTouchEnd: noop,\n  onTouchCancel: noop,\n  onTap: noop,\n  onMouseMove: noop,\n  onMouseEnter: noop,\n  onMouseLeave: noop,\n  onMouseWheel: noop,\n  onKeyDown: noop,\n  onKeyUp: noop\n};\n\nexport const Keys = KEYS;\n\nfunction keyOf(code) {\n  const keyMap = Keys;\n  for (const name in keyMap) {\n    if (keyMap[name] === code) {\n      return name;\n    }\n  }\n  return null;\n}\n\nexport function addEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n\nexport function removeEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n"],"file":"add-events.js"}