{"version":3,"sources":["../../../src/webgl-context/get-parameter.js"],"names":["isWebGL2","gl","GL_TEXTURE_BINDING_3D","WEBGL_debug_renderer_info","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_texture_filter_anisotropic","WEBGL_LIMITS","Float32Array","Int32Array","getContextLimits","luma","limits","webgl1MinLimits","webgl2MinLimits","isWebgl2","parameter","limit","webgl1MinLimit","gl1","webgl2MinLimit","gl2","minLimit","limitNotAvailable","getExtension","extension","value","getParameter","originalFunc","pname","GL_UNMASKED_VENDOR_WEBGL","GL_UNMASKED_RENDERER_WEBGL","GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT","GL_FRAGMENT_SHADER_DERIVATIVE_HINT","GL_DONT_CARE","GL_GPU_DISJOINT_EXT","extensions","info","UNMASKED_VENDOR_WEBGL","UNMASKED_RENDERER_WEBGL","undefined","hasTimerQueries","ext","MAX_TEXTURE_MAX_ANISOTROPY_EXT"],"mappings":"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","sourcesContent":["// A major polyfill of \"gl.getParameter\"\n// Attempts to return sane values for all known WebGL2 and extension constants\n/* eslint-disable camelcase */\nimport GL from '../constants';\n\n// Return true if WebGL2 context\nfunction isWebGL2(gl) {\n  const GL_TEXTURE_BINDING_3D = 0x806A;\n  return gl && gl.TEXTURE_BINDING_3D === GL_TEXTURE_BINDING_3D;\n}\n\nconst WEBGL_debug_renderer_info = 'WEBGL_debug_renderer_info';\nconst EXT_disjoint_timer_query = 'EXT_disjoint_timer_query';\nconst EXT_disjoint_timer_query_webgl2 = 'EXT_disjoint_timer_query_webgl2';\nconst EXT_texture_filter_anisotropic = 'EXT_texture_filter_anisotropic';\n\nconst WEBGL_LIMITS = {\n  [GL.ALIASED_LINE_WIDTH_RANGE]: [new Float32Array([1, 1])],\n  [GL.ALIASED_POINT_SIZE_RANGE]: [new Float32Array([1, 1])],\n  [GL.MAX_TEXTURE_SIZE]: [64, 2048],\n  [GL.MAX_CUBE_MAP_TEXTURE_SIZE]: [16],\n  [GL.MAX_TEXTURE_IMAGE_UNITS]: [8],\n  [GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS]: [8],\n  [GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS]: [0],\n  [GL.MAX_RENDERBUFFER_SIZE]: [1],\n  [GL.MAX_VARYING_VECTORS]: [8],\n  [GL.MAX_VERTEX_ATTRIBS]: [8],\n  [GL.MAX_VERTEX_UNIFORM_VECTORS]: [128],\n  [GL.MAX_FRAGMENT_UNIFORM_VECTORS]: [16],\n  [GL.MAX_VIEWPORT_DIMS]: [new Int32Array([0, 0])],\n\n  // Extensions\n  // [GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]: [1]\n\n  // WebGL2 Limits\n  [GL.MAX_3D_TEXTURE_SIZE]: [0, 256],\n  [GL.MAX_ARRAY_TEXTURE_LAYERS]: [0, 256],\n  [GL.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]: [0, 0],\n  [GL.MAX_COLOR_ATTACHMENTS]: [0, 4],\n  [GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_COMBINED_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_DRAW_BUFFERS]: [0, 4],\n  [GL.MAX_ELEMENT_INDEX]: [0, 0],\n  [GL.MAX_ELEMENTS_INDICES]: [0, 0],\n  [GL.MAX_ELEMENTS_VERTICES]: [0, 0],\n  [GL.MAX_FRAGMENT_INPUT_COMPONENTS]: [0, 0],\n  [GL.MAX_FRAGMENT_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_FRAGMENT_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MAX_SAMPLES]: [0, 0],\n  [GL.MAX_SERVER_WAIT_TIMEOUT]: [0, 0],\n  [GL.MAX_TEXTURE_LOD_BIAS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]: [0, 0],\n  [GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]: [0, 0],\n  [GL.MAX_UNIFORM_BLOCK_SIZE]: [0, 0],\n  [GL.MAX_UNIFORM_BUFFER_BINDINGS]: [0, 0],\n  [GL.MAX_VARYING_COMPONENTS]: [0, 0],\n  [GL.MAX_VERTEX_OUTPUT_COMPONENTS]: [0, 0],\n  [GL.MAX_VERTEX_UNIFORM_BLOCKS]: [0, 0],\n  [GL.MAX_VERTEX_UNIFORM_COMPONENTS]: [0, 0],\n  [GL.MIN_PROGRAM_TEXEL_OFFSET]: [0, -8],\n  [GL.MAX_PROGRAM_TEXEL_OFFSET]: [0, 7],\n  [GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT]: [0, 0]\n};\n\n// const EXTENSION_SETTINGS = {\n//   [GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]: 'anisotropy'\n// };\n\nexport function getContextLimits(gl) {\n  gl.luma = gl.luma || {};\n\n  if (!gl.luma.limits) {\n    gl.luma.limits = {};\n    gl.luma.webgl1MinLimits = {};\n    gl.luma.webgl2MinLimits = {};\n\n    const isWebgl2 = isWebGL2(gl);\n\n    // WEBGL limits\n    for (const parameter in WEBGL_LIMITS) {\n      const limit = WEBGL_LIMITS[parameter];\n\n      const webgl1MinLimit = limit.gl1;\n      const webgl2MinLimit = 'gl2' in limit ? limit.gl2 : limit.gl1;\n      const minLimit = isWebgl2 ? webgl2MinLimit : webgl1MinLimit;\n\n      // Check if we can query for this limit\n      const limitNotAvailable =\n        ('gl2' in limit && !isWebgl2) ||\n        ('extension' in limit && !gl.getExtension(limit.extension));\n\n      const value = limitNotAvailable ? minLimit : gl.getParameter(parameter);\n      gl.luma.limits[parameter] = value;\n      gl.luma.webgl1MinLimits[parameter] = webgl1MinLimit;\n      gl.luma.webgl2MinLimits[parameter] = webgl2MinLimit;\n    }\n  }\n\n  return gl.luma.limits;\n}\n\nexport function getParameter(gl, originalFunc, pname) {\n  const GL_UNMASKED_VENDOR_WEBGL = 0x9245; // vendor string of the graphics driver.\n  const GL_UNMASKED_RENDERER_WEBGL = 0x9246; // renderer string of the graphics driver.\n\n  const GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT = 0x84FF;\n\n  const GL_FRAGMENT_SHADER_DERIVATIVE_HINT = 0x8B8B;\n  const GL_DONT_CARE = 0x1100;\n  const GL_GPU_DISJOINT_EXT = 0x8FBB;\n\n  const {extensions} = gl.luma;\n\n  const info = gl.getExtension(WEBGL_debug_renderer_info);\n\n  switch (pname) {\n  // EXTENSIONS SOMETIMES DO NOT USE THE OFFICIAL CONSTANTS.\n  case GL_UNMASKED_VENDOR_WEBGL:\n    return originalFunc((info && info.UNMASKED_VENDOR_WEBGL) || GL.VENDOR);\n  case GL_UNMASKED_RENDERER_WEBGL:\n    return originalFunc((info && info.UNMASKED_RENDERER_WEBGL) || GL.RENDERER);\n\n  case GL_FRAGMENT_SHADER_DERIVATIVE_HINT:\n    return !isWebGL2(gl) ? GL_DONT_CARE : undefined;\n\n  case GL_GPU_DISJOINT_EXT:\n    const hasTimerQueries =\n      !extensions[EXT_disjoint_timer_query] && !extensions[EXT_disjoint_timer_query_webgl2];\n    return hasTimerQueries ? 0 : undefined;\n\n  case GL_MAX_TEXTURE_MAX_ANISOTROPY_EXT:\n    const ext = gl.luma.extensions[EXT_texture_filter_anisotropic];\n    pname = ext && ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT;\n    return !pname ? 1.0 : undefined;\n\n  default:\n    return undefined;\n  }\n}\n"],"file":"get-parameter.js"}