{"version":3,"sources":["../../../../src/addons/events/add-events.js"],"names":["noop","KEYS","enter","up","down","left","right","esc","space","backspace","tab","delete","toO3D","n","_getPos","elem","bbox","getBoundingClientRect","x","y","top","get","e","win","window","event","getWheel","wheelDelta","detail","getKey","code","which","keyCode","key","keyOf","fKey","String","fromCharCode","toLowerCase","shift","shiftKey","control","ctrlKey","alt","altKey","meta","metaKey","isRightClick","button","getPos","doc","document","documentElement","body","touches","length","touchesPos","l","evt","i","push","pageX","clientX","scrollLeft","pageY","clientY","scrollTop","page","stop","stopPropagation","cancelBubble","preventDefault","returnValue","EventsProxy","constructor","domElem","opt","scene","pos","callbacks","size","width","offsetWidth","height","offsetHeight","attachEvents","disableContextMenu","oncontextmenu","enableMouse","forEach","action","addEventListener","eventInfo","type","getBoxObjectFor","mozInnerScreenX","enableTouch","enableKeyboard","getSize","relative","centerOrigin","cachePosition","ge","epos","origPos","wheel","Object","assign","cacheTarget","posArray","cache","getTarget","picking","pick","cacheSize","mouseup","moved","onRightClick","hovered","onClick","pressed","onDragEnd","onDragCancel","mouseout","rt","relatedTarget","parentNode","onMouseLeave","mouseover","mousemove","onDragMove","target","hash","onMouseEnter","onMouseMove","mousewheel","onMouseWheel","mousedown","onDragStart","touchstart","touched","touchedLastPosition","onTouchStart","touchmove","touchMoved","onTouchMove","touchend","onTouchEnd","isNaN","onTap","onTouchCancel","keydown","onKeyDown","keyup","onKeyUp","prototype","DEFAULT_OPTS","bind","Keys","keyMap","name","addEvents","domElement","match","fname","fn","f","apply","Array","slice","call","arguments","removeEvents"],"mappings":"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","sourcesContent":["// event.js\n// Handle keyboard/mouse/touch events in the Canvas\n// TODO - this will not work under node\n\n/* eslint-disable dot-notation, max-statements, no-loop-func */\n/* global window, document */\nfunction noop() {}\n\nconst KEYS = {\n  enter: 13,\n  up: 38,\n  down: 40,\n  left: 37,\n  right: 39,\n  esc: 27,\n  space: 32,\n  backspace: 8,\n  tab: 9,\n  delete: 46\n};\n\n// returns an O3D object or false otherwise.\nfunction toO3D(n) {\n  return n !== true ? n : false;\n}\n\n// Returns an element position\nfunction _getPos(elem) {\n  const bbox = elem.getBoundingClientRect();\n  return {\n    x: bbox.left,\n    y: bbox.top,\n    bbox\n  };\n}\n\n// event object wrapper\nexport function get(e, win) {\n  win = win || window;\n  return e || win.event;\n}\n\nexport function getWheel(e) {\n  return e.wheelDelta ? e.wheelDelta / 120 : -(e.detail || 0) / 3;\n}\n\nexport function getKey(e) {\n  const code = e.which || e.keyCode;\n  let key = keyOf(code);\n  // onkeydown\n  const fKey = code - 111;\n  if (fKey > 0 && fKey < 13) {\n    key = `f${fKey}`;\n  }\n  key = key || String.fromCharCode(code).toLowerCase();\n\n  return {\n    code,\n    key,\n    shift: e.shiftKey,\n    control: e.ctrlKey,\n    alt: e.altKey,\n    meta: e.metaKey\n  };\n}\n\nexport function isRightClick(e) {\n  return e.which === 3 || e.button === 2;\n}\n\nexport function getPos(e, win) {\n  // get mouse position\n  win = win || window;\n  e = e || win.event;\n  let doc = win.document;\n  doc = doc.documentElement || doc.body;\n  // TODO(nico): make touch event handling better\n  if (e.touches && e.touches.length) {\n    const touchesPos = [];\n    const l = e.touches.length;\n    let evt;\n    for (let i = 0; i < l; ++i) {\n      evt = e.touches[i];\n      touchesPos.push({\n        x: evt.pageX || (evt.clientX + doc.scrollLeft),\n        y: evt.pageY || (evt.clientY + doc.scrollTop)\n      });\n    }\n    return touchesPos;\n  }\n  const page = {\n    x: e.pageX || (e.clientX + doc.scrollLeft),\n    y: e.pageY || (e.clientY + doc.scrollTop)\n  };\n  return [page];\n}\n\nexport function stop(e) {\n  if (e.stopPropagation) {\n    e.stopPropagation();\n  }\n  e.cancelBubble = true;\n  if (e.preventDefault) {\n    e.preventDefault();\n  } else {\n    e.returnValue = false;\n  }\n}\n\nexport class EventsProxy {\n\n  constructor(domElem, opt) {\n    this.scene = opt.scene;\n    this.domElem = domElem;\n    this.pos = _getPos(domElem);\n    this.opt = this.callbacks = opt;\n\n    this.size = {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n\n    this.attachEvents();\n  }\n\n  attachEvents() {\n    const domElem = this.domElem;\n    const opt = this.opt;\n\n    if (opt.disableContextMenu) {\n      domElem.oncontextmenu = () => false;\n    }\n\n    if (opt.enableMouse) {\n      ['mouseup', 'mousedown', 'mousemove', 'mouseover', 'mouseout']\n      .forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n\n      // \"well, this is embarrassing...\"\n      let type = '';\n      if (!document.getBoxObjectFor && window.mozInnerScreenX === null) {\n        type = 'mousewheel';\n      } else {\n        type = 'DOMMouseScroll';\n      }\n      domElem.addEventListener(type, (e, win) => {\n        this['mousewheel'](this.eventInfo('mousewheel', e, win));\n      }, false);\n    }\n\n    if (opt.enableTouch) {\n      ['touchstart', 'touchmove', 'touchend'].forEach(action => {\n        domElem.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n\n    if (opt.enableKeyboard) {\n      ['keydown', 'keyup'].forEach(action => {\n        document.addEventListener(action, (e, win) => {\n          this[action](this.eventInfo(action, e, win));\n        }, false);\n      });\n    }\n  }\n\n  eventInfo(type, e, win) {\n    const domElem = this.domElem;\n    const scene = this.scene;\n    const opt = this.opt;\n    const size = this.getSize();\n    const relative = opt.relative;\n    const centerOrigin = opt.centerOrigin;\n    const pos = opt.cachePosition && this.pos || _getPos(domElem);\n    const ge = get(e, win);\n    const epos = getPos(e, win);\n    const origPos = {x: epos[0].x, y: epos[0].y};\n    const evt = {};\n    let x;\n    let y;\n\n    // get Position\n    for (let i = 0, l = epos.length; i < l; ++i) {\n      x = epos[i].x;\n      y = epos[i].y;\n      if (relative) {\n        x -= pos.x; y -= pos.y;\n        if (centerOrigin) {\n          x -= size.width / 2;\n          y -= size.height / 2;\n          // y axis now points to the top of the screen\n          y *= -1;\n        }\n      }\n      epos[i].x = x;\n      epos[i].y = y;\n    }\n\n    switch (type) {\n    case 'mousewheel':\n      evt.wheel = getWheel(ge);\n      break;\n    case 'keydown':\n    case 'keyup':\n      Object.assign(evt, getKey(ge));\n      break;\n    case 'mouseup':\n      evt.isRightClick = isRightClick(ge);\n      break;\n    default:\n      break;\n    }\n\n    let cacheTarget;\n\n    Object.assign(evt, {\n      x: epos[0].x,\n      y: epos[0].y,\n      posArray: epos,\n\n      cache: false,\n      // stop event propagation\n      stop() {\n        stop(ge);\n      },\n      // get the target element of the event\n      getTarget() {\n        if (cacheTarget) {\n          return cacheTarget;\n        }\n        return (cacheTarget = opt.picking &&\n          scene.pick(origPos.x - pos.x, origPos.y - pos.y) || true);\n      }\n    });\n    // wrap native event\n    evt.event = ge;\n\n    return evt;\n  }\n\n  getSize() {\n    if (this.cacheSize) {\n      return this.size;\n    }\n    const domElem = this.domElem;\n    return {\n      width: domElem.width || domElem.offsetWidth,\n      height: domElem.height || domElem.offsetHeight\n    };\n  }\n\n  mouseup(e) {\n    if (!this.moved) {\n      if (e.isRightClick) {\n        this.callbacks.onRightClick(e, this.hovered);\n      } else {\n        this.callbacks.onClick(e, toO3D(this.pressed));\n      }\n    }\n    if (this.pressed) {\n      if (this.moved) {\n        this.callbacks.onDragEnd(e, toO3D(this.pressed));\n      } else {\n        this.callbacks.onDragCancel(e, toO3D(this.pressed));\n      }\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseout(e) {\n    // mouseout canvas\n    let rt = e.relatedTarget;\n    const domElem = this.domElem;\n    while (rt && rt.parentNode) {\n      if (domElem === rt.parentNode) {\n        return;\n      }\n      rt = rt.parentNode;\n    }\n    if (this.hovered) {\n      this.callbacks.onMouseLeave(e, this.hovered);\n      this.hovered = false;\n    }\n    if (this.pressed && this.moved) {\n      this.callbacks.onDragEnd(e);\n      this.pressed = this.moved = false;\n    }\n  }\n\n  mouseover(e) {\n  }\n\n  mousemove(e) {\n    if (this.pressed) {\n      this.moved = true;\n      this.callbacks.onDragMove(e, toO3D(this.pressed));\n      return;\n    }\n    if (this.hovered) {\n      const target = toO3D(e.getTarget());\n      if (!target || target.hash !== this.hash) {\n        this.callbacks.onMouseLeave(e, this.hovered);\n        this.hovered = target;\n        this.hash = target;\n        if (target) {\n          this.hash = target.hash;\n          this.callbacks.onMouseEnter(e, this.hovered);\n        }\n      } else {\n        this.callbacks.onMouseMove(e, this.hovered);\n      }\n    } else {\n      this.hovered = toO3D(e.getTarget());\n      this.hash = this.hovered;\n      if (this.hovered) {\n        this.hash = this.hovered.hash;\n        this.callbacks.onMouseEnter(e, this.hovered);\n      }\n    }\n    if (!this.opt.picking) {\n      this.callbacks.onMouseMove(e);\n    }\n  }\n\n  mousewheel(e) {\n    this.callbacks.onMouseWheel(e);\n  }\n\n  mousedown(e) {\n    this.pressed = e.getTarget();\n    this.callbacks.onDragStart(e, toO3D(this.pressed));\n  }\n\n  touchstart(e) {\n    this.touched = e.getTarget();\n    this.touchedLastPosition = {x: e.x, y: e.y};\n    this.callbacks.onTouchStart(e, toO3D(this.touched));\n  }\n\n  touchmove(e) {\n    if (this.touched) {\n      this.touchMoved = true;\n      this.callbacks.onTouchMove(e, toO3D(this.touched));\n    }\n  }\n\n  touchend(e) {\n    if (this.touched) {\n      if (this.touchMoved) {\n        this.callbacks.onTouchEnd(e, toO3D(this.touched));\n      } else {\n        e.x = isNaN(e.x) ? this.touchedLastPosition.x : e.x;\n        e.y = isNaN(e.y) ? this.touchedLastPosition.y : e.y;\n        this.callbacks.onTap(e, toO3D(this.touched));\n        this.callbacks.onTouchCancel(e, toO3D(this.touched));\n      }\n      this.touched = this.touchMoved = false;\n    }\n  }\n\n  keydown(e) {\n    this.callbacks.onKeyDown(e);\n  }\n\n  keyup(e) {\n    this.callbacks.onKeyUp(e);\n  }\n}\n\nObject.assign(EventsProxy.prototype, {\n  hovered: false,\n  pressed: false,\n  touched: false,\n  touchedLastPosition: {x: 0, y: 0},\n  touchMoved: false,\n  moved: false\n});\n\nconst DEFAULT_OPTS = {\n  cachePosition: true,\n  cacheSize: true,\n  relative: true,\n  centerOrigin: true,\n  disableContextMenu: true,\n  bind: false,\n  picking: false,\n\n  enableTouch: true,\n  enableMouse: true,\n  enableKeyboard: true,\n\n  onClick: noop,\n  onRightClick: noop,\n  onDragStart: noop,\n  onDragMove: noop,\n  onDragEnd: noop,\n  onDragCancel: noop,\n  onTouchStart: noop,\n  onTouchMove: noop,\n  onTouchEnd: noop,\n  onTouchCancel: noop,\n  onTap: noop,\n  onMouseMove: noop,\n  onMouseEnter: noop,\n  onMouseLeave: noop,\n  onMouseWheel: noop,\n  onKeyDown: noop,\n  onKeyUp: noop\n};\n\nexport const Keys = KEYS;\n\nfunction keyOf(code) {\n  const keyMap = Keys;\n  for (const name in keyMap) {\n    if (keyMap[name] === code) {\n      return name;\n    }\n  }\n  return null;\n}\n\nexport function addEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n\nexport function removeEvents(domElement, opt = {}) {\n  opt = Object.assign({}, DEFAULT_OPTS, opt);\n\n  const bind = opt.bind;\n  if (bind) {\n    for (const name in opt) {\n      if (name.match(/^on[a-zA-Z0-9]+$/)) {\n        ((fname, fn) => {\n          opt[fname] = function f() {\n            fn.apply(bind, Array.prototype.slice.call(arguments));\n          };\n        })(name, opt[name]);\n      }\n    }\n  }\n\n  return new EventsProxy(domElement, opt);\n}\n"],"file":"add-events.js"}