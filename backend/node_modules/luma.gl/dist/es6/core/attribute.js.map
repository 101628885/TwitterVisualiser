{"version":3,"sources":["../../../src/core/attribute.js"],"names":["Buffer","log","uid","Attribute","constructor","gl","opts","id","type","isIndexed","target","value","externalBuffer","buffer","userData","update","Object","seal","_validateAttributeDefinition","delete","constant","accessor","divisor","undefined","assign","setData","data","_setAccessor","getBuffer","getValue","size","offset","stride","normalized","integer","instanced","isInstanced","deprecated"],"mappings":"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","sourcesContent":["/* eslint-disable complexity */\nimport GL from '../constants';\nimport {Buffer} from '../webgl';\nimport {log, uid} from '../utils';\n\nexport default class Attribute {\n  constructor(gl, opts = {}) {\n    const {\n      id = uid('attribute'),\n      type,\n      isIndexed = false\n    } = opts;\n\n    // Options that cannot be changed later\n    this.gl = gl;\n    this.id = id;\n    this.isIndexed = isIndexed;\n    this.target = isIndexed ? GL.ELEMENT_ARRAY_BUFFER : GL.ARRAY_BUFFER;\n    this.type = type;\n\n    // Initialize the attribute descriptor, with WebGL and metadata fields\n    this.value = null;\n    this.externalBuffer = null;\n    this.buffer = null;\n    this.userData = {}; // Reserved for application\n    this.update(opts);\n\n    // Sanity - no app fields on our attributes. Use userData instead.\n    Object.seal(this);\n\n    // Check all fields and generate helpful error messages\n    this._validateAttributeDefinition();\n  }\n\n  delete() {\n    if (this.buffer) {\n      this.buffer.delete();\n      this.buffer = null;\n    }\n  }\n\n  update(opts) {\n    const {\n      value,\n      buffer,\n      constant = this.constant || false\n    } = opts;\n\n    this.constant = constant;\n\n    if (buffer) {\n      this.externalBuffer = buffer;\n      this.constant = false;\n\n      this.type = buffer.accessor.type;\n      if (buffer.accessor.divisor !== undefined) {\n        this.divisor = buffer.accessor.divisor;\n      }\n    } else if (value) {\n      this.externalBuffer = null;\n      this.value = value;\n\n      if (!constant) {\n        // Create buffer if needed\n        this.buffer = this.buffer ||\n          new Buffer(this.gl, Object.assign({}, opts, {\n            id: this.id,\n            target: this.target,\n            type: this.type\n          }));\n        this.buffer.setData({data: value});\n        this.type = this.buffer.accessor.type;\n      }\n    }\n\n    this._setAccessor(opts);\n  }\n\n  getBuffer() {\n    if (this.constant) {\n      return null;\n    }\n    return this.externalBuffer || this.buffer;\n  }\n\n  getValue() {\n    if (this.constant) {\n      return this.value;\n    }\n    const buffer = this.externalBuffer || this.buffer;\n    if (buffer) {\n      return [buffer, this];\n    }\n    return null;\n  }\n\n  // Sets all accessor props except type\n  // TODO - store on `this.accessor`\n  _setAccessor(opts) {\n    const {\n      // accessor props\n      size = this.size,\n      offset = this.offset || 0,\n      stride = this.stride || 0,\n      normalized = this.normalized || false,\n      integer = this.integer || false,\n      divisor = this.divisor || 0,\n      instanced,\n      isInstanced\n    } = opts;\n\n    this.size = size;\n    this.offset = offset;\n    this.stride = stride;\n    this.normalized = normalized;\n    this.integer = integer;\n\n    this.divisor = divisor;\n\n    if (isInstanced !== undefined) {\n      log.deprecated('Attribute.isInstanced');\n      this.divisor = isInstanced ? 1 : 0;\n    }\n    if (instanced !== undefined) {\n      log.deprecated('Attribute.instanced');\n      this.divisor = instanced ? 1 : 0;\n    }\n  }\n\n  _validateAttributeDefinition() {\n    // Can be undefined for buffers (auto deduced from shaders)\n    // or larger than 4 for uniform arrays\n    // assert(\n    //   this.size >= 1 && this.size <= 4,\n    //   `Attribute definition for ${this.id} invalid size`\n    // );\n  }\n}\n"],"file":"attribute.js"}