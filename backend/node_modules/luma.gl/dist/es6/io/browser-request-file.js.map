{"version":3,"sources":["../../../src/io/browser-request-file.js"],"names":["noop","XHR_STATES","UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED","XHR","constructor","url","path","method","asynchronous","noCache","sendAsBinary","responseType","onProgress","onError","onAbort","onComplete","join","async","req","XMLHttpRequest","onload","e","onerror","onabort","onprogress","lengthComputable","Math","round","loaded","total","setRequestHeader","header","value","sendAsync","body","Promise","resolve","reject","indexOf","Date","now","open","onreadystatechange","readyState","status","response","responseText","Error","send","error","requestFile","opts","xhr"],"mappings":"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","sourcesContent":["// Supports loading (requesting) assets with XHR (XmlHttpRequest)\n/* eslint-disable guard-for-in, complexity, no-try-catch */\n\n/* global XMLHttpRequest */\nfunction noop() {}\n\nconst XHR_STATES = {\n  UNINITIALIZED: 0,\n  LOADING: 1,\n  LOADED: 2,\n  INTERACTIVE: 3,\n  COMPLETED: 4\n};\n\nclass XHR {\n  constructor({\n    url,\n    path = null,\n    method = 'GET',\n    asynchronous = true,\n    noCache = false,\n    // body = null,\n    sendAsBinary = false,\n    responseType = false,\n    onProgress = noop,\n    onError = noop,\n    onAbort = noop,\n    onComplete = noop\n  }) {\n    this.url = path ? path.join(path, url) : url;\n    this.method = method;\n    this.async = asynchronous;\n    this.noCache = noCache;\n    this.sendAsBinary = sendAsBinary;\n    this.responseType = responseType;\n\n    this.req = new XMLHttpRequest();\n\n    this.req.onload = e => onComplete(e);\n    this.req.onerror = e => onError(e);\n    this.req.onabort = e => onAbort(e);\n    this.req.onprogress = e => {\n      if (e.lengthComputable) {\n        onProgress(e, Math.round(e.loaded / e.total * 100));\n      } else {\n        onProgress(e, -1);\n      }\n    };\n  }\n\n  setRequestHeader(header, value) {\n    this.req.setRequestHeader(header, value);\n    return this;\n  }\n\n  // /* eslint-disable max-statements */\n  sendAsync(body = this.body || null) {\n    return new Promise((resolve, reject) => {\n      try {\n        const {req, method, noCache, sendAsBinary, responseType} = this;\n\n        const url = noCache ?\n          this.url + (this.url.indexOf('?') >= 0 ? '&' : '?') + Date.now() :\n          this.url;\n\n        req.open(method, url, this.async);\n\n        if (responseType) {\n          req.responseType = responseType;\n        }\n\n        if (this.async) {\n          req.onreadystatechange = e => {\n            if (req.readyState === XHR_STATES.COMPLETED) {\n              if (req.status === 200) {\n                resolve(req.responseType ? req.response : req.responseText);\n              } else {\n                reject(new Error(`${req.status}: ${url}`));\n              }\n            }\n          };\n        }\n\n        if (sendAsBinary) {\n          req.sendAsBinary(body);\n        } else {\n          req.send(body);\n        }\n\n        if (!this.async) {\n          if (req.status === 200) {\n            resolve(req.responseType ? req.response : req.responseText);\n          } else {\n            reject(new Error(`${req.status}: ${url}`));\n          }\n        }\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n  /* eslint-enable max-statements */\n}\n\nexport function requestFile(opts) {\n  const xhr = new XHR(opts);\n  return xhr.sendAsync();\n}\n"],"file":"browser-request-file.js"}