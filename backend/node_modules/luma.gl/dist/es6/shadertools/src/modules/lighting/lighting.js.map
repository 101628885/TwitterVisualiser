{"version":3,"sources":["../../../../../../src/shadertools/src/modules/lighting/lighting.js"],"names":["Vector3","commonShader","vertexShader1","fragmentShader1","vertexShader","fragmentShader","name","config","MAX_POINT_LIGHTS","getUniforms","lightingEnable","lightingAmbientColor","lightingDirection","lightingDirectionalColor","lightingPointLights","Object","assign","getDirectionalUniforms","getPointUniforms","color","direction","dir","x","y","z","normalize","scale","directionalColor","r","g","b","points","Array","numberPoints","length","pointLocations","pointColors","enableSpecular","pointSpecularColors","point","position","diffuse","specular","pointColor","push","Number","Boolean","pointLocation","pointSpecularColor","vs","fs"],"mappings":"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","sourcesContent":["import {Vector3} from 'math.gl';\n\nimport commonShader from './lighting-common.glsl';\nimport vertexShader1 from './lighting-vertex.glsl';\nimport fragmentShader1 from './lighting-fragment.glsl';\n\nexport const vertexShader = `\\\n${commonShader}\n${vertexShader1}\n`;\n\nexport const fragmentShader = `\\\n${commonShader}\n${fragmentShader1}\n`;\n\nexport const name = 'lighting';\n\nexport const config = {\n  MAX_POINT_LIGHTS: 4\n};\n\n// Setup the lighting system: ambient, directional, point lights.\nexport function getUniforms({\n  lightingEnable = false,\n\n  // ambient light\n  lightingAmbientColor = [0.2, 0.2, 0.2],\n\n  // directional light\n  lightingDirection = [1, 1, 1],\n  lightingDirectionalColor = [0, 0, 0],\n\n  // point lights\n  lightingPointLights = []\n}) {\n  // Set light uniforms. Ambient, directional and point lights.\n  return Object.assign(\n    {\n      lightingEnable,\n      // Ambient\n      lightingAmbientColor\n    },\n    getDirectionalUniforms(lightingDirection),\n    getPointUniforms(lightingPointLights)\n  );\n}\n\nfunction getDirectionalUniforms({color, direction}) {\n  // Normalize lighting direction vector\n  const dir = new Vector3(direction.x, direction.y, direction.z)\n    .normalize()\n    .scale(-1, -1, -1);\n\n  return {\n    directionalColor: [color.r, color.g, color.b],\n    lightingDirection: [dir.x, dir.y, dir.z]\n  };\n}\n\nfunction getPointUniforms(points) {\n  points = points instanceof Array ? points : [points];\n  const numberPoints = points.length;\n  const pointLocations = [];\n  const pointColors = [];\n  const enableSpecular = [];\n  const pointSpecularColors = [];\n  for (const point of points) {\n    const {position, color, diffuse, specular} = point;\n    const pointColor = color || diffuse;\n\n    pointLocations.push(position.x, position.y, position.z);\n    pointColors.push(pointColor.r, pointColor.g, pointColor.b);\n\n    // Add specular color\n    enableSpecular.push(Number(Boolean(specular)));\n    if (specular) {\n      pointSpecularColors.push(specular.r, specular.g, specular.b);\n    } else {\n      pointSpecularColors.push(0, 0, 0);\n    }\n  }\n\n  return {\n    numberPoints,\n    pointLocation: pointLocations,\n    pointColor: pointColors,\n    enableSpecular,\n    pointSpecularColor: pointSpecularColors\n  };\n}\n\nexport default {\n  name,\n  vs: vertexShader,\n  fs: fragmentShader,\n  getUniforms\n};\n"],"file":"lighting.js"}