{"version":3,"sources":["../../../src/webgl1/polyfill-vertex-array-object.js"],"names":["OES_vertex_array_object","GL_VERTEX_ARRAY_BINDING","VertexAttrib","constructor","gl","enabled","buffer","size","type","normalized","stride","offset","cached","recache","join","WebGLVertexArrayObjectOES","ext","isAlive","hasBeenBound","elementArrayBuffer","attribs","Array","maxVertexAttribs","n","length","attrib","maxAttrib","OESVertexArrayObject","wrapGLError","_polyfillWebGLRenderingContext","VERTEX_ARRAY_BINDING_OES","createVertexArrayOES","arrayObject","vertexArrayObjects","push","deleteVertexArrayOES","splice","indexOf","currentVertexArrayObject","bindVertexArrayOES","isVertexArrayOES","synthesizeGLError","original","oldVAO","defaultVertexArrayObject","newVAO","bindBuffer","call","currentBinding","currentArrayBuffer","Math","max","oldAttrib","enableVertexAttribArray","disableVertexAttribArray","bufferChanged","vertexAttribPointer","getParameter","getVertexAttrib","self","Object","assign","pname","apply","arguments","index","vao","target","Error","indx","instrumentExtension","canvas","addEventListener","console","debug","_reset","contextWasLost","undefined","ii","glErrorShadow","err","optionalMessage","error","originalFunc","getError","parseInt","polyfillVertexArrayObject","WebGLRenderingContext","isWebGL2","VERTEX_ARRAY_BINDING","originalMethods","POLYFILL_METHODS","getSupportedExtensions","list","getExtension","name","__OESVertexArrayObject","contextUsesPrototype","Boolean","prototype","polyfillContext"],"mappings":"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","sourcesContent":["/*\n** Copyright (c) 2015 The Khronos Group Inc.\n**\n** Permission is hereby granted, free of charge, to any person obtaining a\n** copy of this software and/or associated documentation files (the\n** 'Materials'), to deal in the Materials without restriction, including\n** without limitation the rights to use, copy, modify, merge, publish,\n** distribute, sublicense, and/or sell copies of the Materials, and to\n** permit persons to whom the Materials are furnished to do so, subject to\n** the following conditions:\n**\n** The above copyright notice and this permission notice shall be included\n** in all copies or substantial portions of the Materials.\n**\n** THE MATERIALS ARE PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n*/\n\n// This file is a repackaging of the Khronos groups VertexArrayObject polyfill\n\n/* eslint-disable camelcase, no-console */\n/* global console */\n\nconst OES_vertex_array_object = 'OES_vertex_array_object';\nconst GL_VERTEX_ARRAY_BINDING = 0x85B5;\n\n// A helper class\nclass VertexAttrib {\n  constructor(gl) {\n    this.enabled = false;\n    this.buffer = null;\n    this.size = 4;\n    this.type = gl.FLOAT;\n    this.normalized = false;\n    this.stride = 16;\n    this.offset = 0;\n\n    this.cached = '';\n    this.recache();\n  }\n\n  recache() {\n    this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n  }\n}\n\n// The emulated VertexArrayObject instance\nclass WebGLVertexArrayObjectOES {\n  constructor(ext) {\n    const gl = ext.gl;\n\n    this.ext = ext;\n    this.isAlive = true;\n    this.hasBeenBound = false;\n\n    this.elementArrayBuffer = null;\n    this.attribs = new Array(ext.maxVertexAttribs);\n    for (let n = 0; n < this.attribs.length; n++) {\n      const attrib = new VertexAttrib(gl);\n      this.attribs[n] = attrib;\n    }\n\n    this.maxAttrib = 0;\n  }\n}\n\n// The emulated OES_vertex_array_object **weblg extension**\nclass OESVertexArrayObject {\n  constructor(gl) {\n    this.gl = gl;\n\n    wrapGLError(gl);\n\n    this._polyfillWebGLRenderingContext(gl);\n  }\n\n  get VERTEX_ARRAY_BINDING_OES() {\n    return GL_VERTEX_ARRAY_BINDING;\n  }\n\n  createVertexArrayOES() {\n    const arrayObject = new WebGLVertexArrayObjectOES(this);\n    this.vertexArrayObjects.push(arrayObject);\n    return arrayObject;\n  }\n\n  deleteVertexArrayOES(arrayObject) {\n    arrayObject.isAlive = false;\n    this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n    if (this.currentVertexArrayObject === arrayObject) {\n      this.bindVertexArrayOES(null);\n    }\n  }\n\n  isVertexArrayOES(arrayObject) {\n    if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n      if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /* eslint-disable max-statements, complexity, max-depth */\n  bindVertexArrayOES(arrayObject) {\n    const gl = this.gl;\n    if (arrayObject && !arrayObject.isAlive) {\n      synthesizeGLError(gl.INVALID_OPERATION,\n        'bindVertexArrayOES: attempt to bind deleted arrayObject');\n      return;\n    }\n    const original = this.original;\n\n    const oldVAO = this.currentVertexArrayObject;\n    this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n    this.currentVertexArrayObject.hasBeenBound = true;\n    const newVAO = this.currentVertexArrayObject;\n\n    if (oldVAO === newVAO) {\n      return;\n    }\n\n    if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n      original.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n    }\n\n    let currentBinding = this.currentArrayBuffer;\n    const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n    for (let n = 0; n <= maxAttrib; n++) {\n      const attrib = newVAO.attribs[n];\n      const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n      if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n        if (attrib.enabled) {\n          original.enableVertexAttribArray.call(gl, n);\n        } else {\n          original.disableVertexAttribArray.call(gl, n);\n        }\n      }\n\n      if (attrib.enabled) {\n        let bufferChanged = false;\n        if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n          if (currentBinding !== attrib.buffer) {\n            original.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n            currentBinding = attrib.buffer;\n          }\n          bufferChanged = true;\n        }\n\n        if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n          original.vertexAttribPointer.call(\n            gl, n, attrib.size, attrib.type, attrib.normalized, attrib.stride, attrib.offset);\n        }\n      }\n    }\n\n    if (this.currentArrayBuffer !== currentBinding) {\n      original.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n    }\n  }\n  /* eslint-enable max-statements, complexity, max-depth */\n\n  _polyfillWebGLRenderingContext(gl) {\n\n    const original = this.original = {\n      getParameter: gl.getParameter,\n      enableVertexAttribArray: gl.enableVertexAttribArray,\n      disableVertexAttribArray: gl.disableVertexAttribArray,\n      bindBuffer: gl.bindBuffer,\n      getVertexAttrib: gl.getVertexAttrib,\n      vertexAttribPointer: gl.vertexAttribPointer\n    };\n\n    const self = this;\n\n    Object.assign(gl, {\n      getParameter(pname) {\n        if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n          return self.currentVertexArrayObject === self.defaultVertexArrayObject ?\n            null :\n            self.currentVertexArrayObject;\n        }\n        return original.getParameter.apply(this, arguments);\n      },\n\n      enableVertexAttribArray(index) {\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, index);\n        const attrib = vao.attribs[index];\n        attrib.enabled = true;\n        return original.enableVertexAttribArray.apply(this, arguments);\n      },\n\n      disableVertexAttribArray(index) {\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, index);\n        const attrib = vao.attribs[index];\n        attrib.enabled = false;\n        return original.disableVertexAttribArray.apply(this, arguments);\n      },\n\n      bindBuffer(target, buffer) {\n        switch (target) {\n        case gl.ARRAY_BUFFER:\n          self.currentArrayBuffer = buffer;\n          break;\n        case gl.ELEMENT_ARRAY_BUFFER:\n          self.currentVertexArrayObject.elementArrayBuffer = buffer;\n          break;\n        default:\n          throw new Error();\n        }\n        return original.bindBuffer.apply(this, arguments);\n      },\n\n      getVertexAttrib(index, pname) {\n        const vao = self.currentVertexArrayObject;\n        const attrib = vao.attribs[index];\n        switch (pname) {\n        case gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n          return attrib.buffer;\n        case gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n          return attrib.enabled;\n        case gl.VERTEX_ATTRIB_ARRAY_SIZE:\n          return attrib.size;\n        case gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n          return attrib.stride;\n        case gl.VERTEX_ATTRIB_ARRAY_TYPE:\n          return attrib.type;\n        case gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n          return attrib.normalized;\n        default:\n          return original.getVertexAttrib.apply(this, arguments);\n        }\n      },\n\n      /* eslint-disable max-params */\n      vertexAttribPointer(indx, size, type, normalized, stride, offset) {\n      /* eslint-enable max-params */\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n        const attrib = vao.attribs[indx];\n        attrib.buffer = self.currentArrayBuffer;\n        attrib.size = size;\n        attrib.type = type;\n        attrib.normalized = normalized;\n        attrib.stride = stride;\n        attrib.offset = offset;\n        attrib.recache();\n        return original.vertexAttribPointer.apply(this, arguments);\n      }\n    });\n\n    if (gl.instrumentExtension) {\n      gl.instrumentExtension(this, OES_vertex_array_object);\n    }\n\n    // Note: gl.canvas is not available in headless gl\n    if (gl.canvas) {\n      gl.canvas.addEventListener('webglcontextrestored', function() {\n        console.debug('OESVertexArrayObject emulation library context restored');\n        self._reset();\n      }, true);\n    }\n\n    this._reset();\n  }\n\n  _reset() {\n    const contextWasLost = this.vertexArrayObjects !== undefined;\n    if (contextWasLost) {\n      for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n        this.vertexArrayObjects.isAlive = false;\n      }\n    }\n    const gl = this.gl;\n    this.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n    this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n    this.currentVertexArrayObject = null;\n    this.currentArrayBuffer = null;\n    this.vertexArrayObjects = [this.defaultVertexArrayObject];\n\n    this.bindVertexArrayOES(null);\n  }\n}\n\n// ERROR emulation\n\nconst glErrorShadow = {};\n\nfunction synthesizeGLError(err, optionalMessage) {\n  glErrorShadow[err] = true;\n  if (optionalMessage !== undefined) {\n    console.error(optionalMessage);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const originalFunc = gl.getError;\n  Object.assign(gl, {\n    getError() {\n      let err;\n      do {\n        err = originalFunc.apply(gl);\n        if (err !== gl.NO_ERROR) {\n          glErrorShadow[err] = true;\n        }\n      } while (err !== gl.NO_ERROR);\n\n      for (err in glErrorShadow) {\n        if (glErrorShadow[err]) {\n          delete glErrorShadow[err];\n          return parseInt(err, 10);\n        }\n      }\n      return gl.NO_ERROR;\n    }\n  });\n}\n\n// Install polyfill as extension\nexport default function polyfillVertexArrayObject(WebGLRenderingContext, gl) {\n  // 1) WebGL2 supports VertexArrayObjects by default, so return\n  // 2) If already installed, VERTEX_ARRAY_BINDING is defined\n  const isWebGL2 = WebGLRenderingContext.VERTEX_ARRAY_BINDING === GL_VERTEX_ARRAY_BINDING;\n  if (isWebGL2) {\n    return;\n  }\n\n  const originalMethods = {};\n\n  const POLYFILL_METHODS = {\n    // TODO - not per extension spec\n    VERTEX_ARRAY_BINDING: GL_VERTEX_ARRAY_BINDING,\n\n    getSupportedExtensions() {\n      const list = originalMethods.getSupportedExtensions.call(this) || [];\n      if (list.indexOf(OES_vertex_array_object) < 0) {\n        list.push(OES_vertex_array_object);\n      }\n      return list;\n    },\n\n    getExtension(name) {\n      const ext = originalMethods.getExtension.call(this, name);\n      if (ext) {\n        return ext;\n      }\n      if (name !== OES_vertex_array_object) {\n        return null;\n      }\n\n      if (!this.__OESVertexArrayObject) {\n        // console.debug('Setup OES_vertex_array_object polyfill');\n        this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n      }\n      return this.__OESVertexArrayObject;\n    }\n  };\n\n  // Prefer polyfilling on prototype, however headless gl defines methods on context instance.\n  const contextUsesPrototype = Boolean(WebGLRenderingContext.prototype.getExtension);\n  const polyfillContext = contextUsesPrototype ? WebGLRenderingContext.prototype : gl;\n  Object.assign(originalMethods, {\n    getSupportedExtensions: polyfillContext.getSupportedExtensions,\n    getExtension: polyfillContext.getExtension\n  });\n\n  // Add polyfills, either once on prototype, or on each context if needed\n  if (contextUsesPrototype) {\n    if (WebGLRenderingContext.prototype.getExtension !== POLYFILL_METHODS.getExtension) {\n      Object.assign(WebGLRenderingContext.prototype, POLYFILL_METHODS);\n    }\n  } else {\n    Object.assign(gl, POLYFILL_METHODS);\n  }\n}\n"],"file":"polyfill-vertex-array-object.js"}