{"version":3,"sources":["../../../src/io/browser-request-file.js"],"names":["noop","XHR_STATES","UNINITIALIZED","LOADING","LOADED","INTERACTIVE","COMPLETED","XHR","url","path","method","asynchronous","noCache","sendAsBinary","responseType","onProgress","onError","onAbort","onComplete","join","async","req","XMLHttpRequest","onload","e","onerror","onabort","onprogress","lengthComputable","Math","round","loaded","total","header","value","setRequestHeader","body","Promise","resolve","reject","indexOf","Date","now","open","onreadystatechange","readyState","status","response","responseText","Error","send","error","requestFile","opts","xhr","sendAsync"],"mappings":"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","sourcesContent":["// Supports loading (requesting) assets with XHR (XmlHttpRequest)\n/* eslint-disable guard-for-in, complexity, no-try-catch */\n\n/* global XMLHttpRequest */\nfunction noop() {}\n\nconst XHR_STATES = {\n  UNINITIALIZED: 0,\n  LOADING: 1,\n  LOADED: 2,\n  INTERACTIVE: 3,\n  COMPLETED: 4\n};\n\nclass XHR {\n  constructor({\n    url,\n    path = null,\n    method = 'GET',\n    asynchronous = true,\n    noCache = false,\n    // body = null,\n    sendAsBinary = false,\n    responseType = false,\n    onProgress = noop,\n    onError = noop,\n    onAbort = noop,\n    onComplete = noop\n  }) {\n    this.url = path ? path.join(path, url) : url;\n    this.method = method;\n    this.async = asynchronous;\n    this.noCache = noCache;\n    this.sendAsBinary = sendAsBinary;\n    this.responseType = responseType;\n\n    this.req = new XMLHttpRequest();\n\n    this.req.onload = e => onComplete(e);\n    this.req.onerror = e => onError(e);\n    this.req.onabort = e => onAbort(e);\n    this.req.onprogress = e => {\n      if (e.lengthComputable) {\n        onProgress(e, Math.round(e.loaded / e.total * 100));\n      } else {\n        onProgress(e, -1);\n      }\n    };\n  }\n\n  setRequestHeader(header, value) {\n    this.req.setRequestHeader(header, value);\n    return this;\n  }\n\n  // /* eslint-disable max-statements */\n  sendAsync(body = this.body || null) {\n    return new Promise((resolve, reject) => {\n      try {\n        const {req, method, noCache, sendAsBinary, responseType} = this;\n\n        const url = noCache ?\n          this.url + (this.url.indexOf('?') >= 0 ? '&' : '?') + Date.now() :\n          this.url;\n\n        req.open(method, url, this.async);\n\n        if (responseType) {\n          req.responseType = responseType;\n        }\n\n        if (this.async) {\n          req.onreadystatechange = e => {\n            if (req.readyState === XHR_STATES.COMPLETED) {\n              if (req.status === 200) {\n                resolve(req.responseType ? req.response : req.responseText);\n              } else {\n                reject(new Error(`${req.status}: ${url}`));\n              }\n            }\n          };\n        }\n\n        if (sendAsBinary) {\n          req.sendAsBinary(body);\n        } else {\n          req.send(body);\n        }\n\n        if (!this.async) {\n          if (req.status === 200) {\n            resolve(req.responseType ? req.response : req.responseText);\n          } else {\n            reject(new Error(`${req.status}: ${url}`));\n          }\n        }\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n  /* eslint-enable max-statements */\n}\n\nexport function requestFile(opts) {\n  const xhr = new XHR(opts);\n  return xhr.sendAsync();\n}\n"],"file":"browser-request-file.js"}