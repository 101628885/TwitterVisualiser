{"version":3,"sources":["../../../src/webgl-context/context-state.js"],"names":["pushContextState","popContextState","getParameter","getParameters","setParameter","setParameters","glSetParameters","resetParameters","getModifiedParameters","isObjectEmpty","assert","LUMA_SETTERS","framebuffer","gl","handle","bindFramebuffer","blend","value","enable","disable","blendColor","blendEquation","args","isArray","blendEquationSeparate","blendFunc","length","blendFuncSeparate","clearColor","clearDepth","clearStencil","colorMask","cull","cullFace","depthTest","depthFunc","depthMask","depthRange","dither","derivativeHint","hint","frontFace","mipmapHint","lineWidth","polygonOffsetFill","polygonOffset","sampleCoverage","scissorTest","scissor","stencilTest","stencilMask","mask","backMask","stencilMaskSeparate","stencilFunc","func","ref","backFunc","backRef","stencilFuncSeparate","stencilOp","sfail","dpfail","dppass","backSfail","backDpfail","backDppass","stencilOpSeparate","viewport","array","Array","ArrayBuffer","isView","parameters","key","setter","withParameters","nocatch","frameBuffer"],"mappings":"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","sourcesContent":["/* eslint-disable no-inline-comments, max-len */\nimport GL from '../constants';\nimport {\n  pushContextState,\n  popContextState\n} from '../webgl-context/track-context-state';\nimport {\n  getParameter,\n  getParameters,\n  setParameter,\n  setParameters as glSetParameters,\n  resetParameters,\n  getModifiedParameters\n} from '../webgl-context/set-parameters';\nimport {isObjectEmpty} from '../utils';\nimport assert from '../utils/assert';\n\n// map of parameter setter function names, parameter constants, default values and types\n// - Uses gl function names, except when setter function exist that are named differently\n// - When the WebGL api offers <setter> and <setter>Separate (e.g. blendEquation and\n//   blendEquationSeparate, we use non-separate name, but accept both non-separate and\n//   separate arguments. Thus, a `getParameter` call will always return all the separate values\n//   in an array, in a form that can be accepted by the setter.\nexport const LUMA_SETTERS = {\n  framebuffer: (gl, framebuffer) => {\n    // accepts 1) a WebGLFramebuffer 2) null (default framebuffer), or 3) luma.gl Framebuffer class\n    // framebuffer is null when restoring to default framebuffer, otherwise use the WebGL handle.\n    const handle = framebuffer && 'handle' in framebuffer ? framebuffer.handle : framebuffer;\n    return gl.bindFramebuffer(GL.FRAMEBUFFER, handle);\n  },\n  blend: (gl, value) => value ? gl.enable(GL.BLEND) : gl.disable(GL.BLEND),\n  blendColor: (gl, value) => gl.blendColor(...value),\n  blendEquation: (gl, args) => {\n    args = isArray(args) ? args : [args, args];\n    gl.blendEquationSeparate(...args);\n  },\n  blendFunc: (gl, args) => {\n    args = isArray(args) && args.length === 2 ? [...args, ...args] : args;\n    gl.blendFuncSeparate(...args);\n  },\n\n  clearColor: (gl, value) => gl.clearColor(...value),\n  clearDepth: (gl, value) => gl.clearDepth(value),\n  clearStencil: (gl, value) => gl.clearStencil(value),\n\n  colorMask: (gl, value) => gl.colorMask(...value),\n\n  cull: (gl, value) => value ? gl.enable(GL.CULL_FACE) : gl.disable(GL.CULL_FACE),\n  cullFace: (gl, value) => gl.cullFace(value),\n\n  depthTest: (gl, value) => value ? gl.enable(GL.DEPTH_TEST) : gl.disable(GL.DEPTH_TEST),\n  depthFunc: (gl, value) => gl.depthFunc(value),\n  depthMask: (gl, value) => gl.depthMask(value),\n  depthRange: (gl, value) => gl.depthRange(...value),\n\n  dither: (gl, value) => value ? gl.enable(GL.DITHER) : gl.disable(GL.DITHER),\n\n  derivativeHint: (gl, value) => {\n    // gl1: 'OES_standard_derivatives'\n    gl.hint(GL.FRAGMENT_SHADER_DERIVATIVE_HINT, value);\n  },\n\n  frontFace: (gl, value) => gl.frontFace(value),\n\n  mipmapHint: (gl, value) => gl.hint(GL.GENERATE_MIPMAP_HINT, value),\n\n  lineWidth: (gl, value) => gl.lineWidth(value),\n\n  polygonOffsetFill: (gl, value) =>\n    value ? gl.enable(GL.POLYGON_OFFSET_FILL) : gl.disable(GL.POLYGON_OFFSET_FILL),\n  polygonOffset: (gl, value) => gl.polygonOffset(...value),\n\n  sampleCoverage: (gl, value) => gl.sampleCoverage(...value),\n\n  scissorTest: (gl, value) => value ? gl.enable(GL.SCISSOR_TEST) : gl.disable(GL.SCISSOR_TEST),\n  scissor: (gl, value) => gl.scissor(...value),\n\n  stencilTest: (gl, value) => value ? gl.enable(GL.STENCIL_TEST) : gl.disable(GL.STENCIL_TEST),\n  stencilMask: (gl, value) => {\n    value = isArray(value) ? value : [value, value];\n    const [mask, backMask] = value;\n    gl.stencilMaskSeparate(GL.FRONT, mask);\n    gl.stencilMaskSeparate(GL.BACK, backMask);\n  },\n  stencilFunc: (gl, args) => {\n    args = isArray(args) && args.length === 3 ? [...args, ...args] : args;\n    const [func, ref, mask, backFunc, backRef, backMask] = args;\n    gl.stencilFuncSeparate(GL.FRONT, func, ref, mask);\n    gl.stencilFuncSeparate(GL.BACK, backFunc, backRef, backMask);\n  },\n  stencilOp: (gl, args) => {\n    args = isArray(args) && args.length === 3 ? [...args, ...args] : args;\n    const [sfail, dpfail, dppass, backSfail, backDpfail, backDppass] = args;\n    gl.stencilOpSeparate(GL.FRONT, sfail, dpfail, dppass);\n    gl.stencilOpSeparate(GL.BACK, backSfail, backDpfail, backDppass);\n  },\n\n  viewport: (gl, value) => gl.viewport(...value)\n};\n\n// HELPERS\n\nfunction isArray(array) {\n  return Array.isArray(array) || ArrayBuffer.isView(array);\n}\n\n// GETTERS AND SETTERS\n\n// Get the parameter value(s) from the context\nexport {getParameter}; // from '../webgl-utils/set-parameters'\n\n// Get the parameters from the context\nexport {getParameters}; // from '../webgl-utils/set-parameters'\n\n// Resets gl state to default values.\nexport {setParameter}; // from '../webgl-utils/set-parameters'\n\n// Resets gl state to default values.\nexport {resetParameters}; // from '../webgl-utils/set-parameters'\n\n// Get a map of modified parameters\nexport {getModifiedParameters};\n\n// Note: \"setParameters\" is given extra treatment below\n\n// Set the parameter value(s) by key to the context\n// Sets value with key to context.\n// Value may be \"normalized\" (in case a short form is supported). In that case\n// the normalized value is retured.\nexport function setParameters(gl, parameters) {\n  glSetParameters(gl, parameters);\n  for (const key in parameters) {\n    const setter = LUMA_SETTERS[key];\n    if (setter) {\n      setter(gl, parameters[key], key);\n    }\n  }\n}\n\n// VERY LIMITED / BASIC GL STATE MANAGEMENT\n// Executes a function with gl states temporarily set, exception safe\n// Currently support pixelStorage, scissor test and framebuffer binding\nexport function withParameters(gl, parameters, func) {\n  // assertWebGLContext(gl);\n\n  if (isObjectEmpty(parameters)) {\n    // Avoid setting state if no parameters provided. Just call and return\n    return func(gl);\n  }\n\n  const {nocatch = true} = parameters;\n  // frameBuffer not supported use framebuffer\n  assert(!parameters.frameBuffer);\n\n  pushContextState(gl);\n  setParameters(gl, parameters);\n\n  // Setup is done, call the function\n  let value;\n\n  if (nocatch) {\n    // Avoid try catch to minimize stack size impact for safe execution paths\n    value = func(gl);\n    popContextState(gl);\n  } else {\n    // Wrap in a try-catch to ensure that parameters are restored on exceptions\n    try {\n      value = func(gl);\n    } finally {\n      popContextState(gl);\n    }\n  }\n\n  return value;\n}\n"],"file":"context-state.js"}