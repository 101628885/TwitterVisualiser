{"version":3,"sources":["../../../src/webgl1/polyfill-vertex-array-object.js"],"names":["OES_vertex_array_object","GL_VERTEX_ARRAY_BINDING","VertexAttrib","gl","enabled","buffer","size","type","normalized","stride","offset","cached","recache","join","WebGLVertexArrayObjectOES","ext","isAlive","hasBeenBound","elementArrayBuffer","attribs","Array","maxVertexAttribs","n","length","attrib","maxAttrib","OESVertexArrayObject","wrapGLError","_polyfillWebGLRenderingContext","arrayObject","vertexArrayObjects","push","splice","indexOf","currentVertexArrayObject","bindVertexArrayOES","synthesizeGLError","original","oldVAO","defaultVertexArrayObject","newVAO","bindBuffer","call","currentBinding","currentArrayBuffer","Math","max","oldAttrib","enableVertexAttribArray","disableVertexAttribArray","bufferChanged","vertexAttribPointer","getParameter","getVertexAttrib","self","Object","assign","pname","VERTEX_ARRAY_BINDING_OES","apply","arguments","index","vao","target","Error","indx","instrumentExtension","canvas","addEventListener","console","debug","_reset","contextWasLost","undefined","ii","glErrorShadow","err","optionalMessage","error","originalFunc","getError","parseInt","polyfillVertexArrayObject","WebGLRenderingContext","isWebGL2","VERTEX_ARRAY_BINDING","originalMethods","POLYFILL_METHODS","getSupportedExtensions","list","getExtension","name","__OESVertexArrayObject","contextUsesPrototype","Boolean","prototype","polyfillContext"],"mappings":"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","sourcesContent":["/*\n** Copyright (c) 2015 The Khronos Group Inc.\n**\n** Permission is hereby granted, free of charge, to any person obtaining a\n** copy of this software and/or associated documentation files (the\n** 'Materials'), to deal in the Materials without restriction, including\n** without limitation the rights to use, copy, modify, merge, publish,\n** distribute, sublicense, and/or sell copies of the Materials, and to\n** permit persons to whom the Materials are furnished to do so, subject to\n** the following conditions:\n**\n** The above copyright notice and this permission notice shall be included\n** in all copies or substantial portions of the Materials.\n**\n** THE MATERIALS ARE PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND,\n** EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n** MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\n** IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\n** CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\n** TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n** MATERIALS OR THE USE OR OTHER DEALINGS IN THE MATERIALS.\n*/\n\n// This file is a repackaging of the Khronos groups VertexArrayObject polyfill\n\n/* eslint-disable camelcase, no-console */\n/* global console */\n\nconst OES_vertex_array_object = 'OES_vertex_array_object';\nconst GL_VERTEX_ARRAY_BINDING = 0x85B5;\n\n// A helper class\nclass VertexAttrib {\n  constructor(gl) {\n    this.enabled = false;\n    this.buffer = null;\n    this.size = 4;\n    this.type = gl.FLOAT;\n    this.normalized = false;\n    this.stride = 16;\n    this.offset = 0;\n\n    this.cached = '';\n    this.recache();\n  }\n\n  recache() {\n    this.cached = [this.size, this.type, this.normalized, this.stride, this.offset].join(':');\n  }\n}\n\n// The emulated VertexArrayObject instance\nclass WebGLVertexArrayObjectOES {\n  constructor(ext) {\n    const gl = ext.gl;\n\n    this.ext = ext;\n    this.isAlive = true;\n    this.hasBeenBound = false;\n\n    this.elementArrayBuffer = null;\n    this.attribs = new Array(ext.maxVertexAttribs);\n    for (let n = 0; n < this.attribs.length; n++) {\n      const attrib = new VertexAttrib(gl);\n      this.attribs[n] = attrib;\n    }\n\n    this.maxAttrib = 0;\n  }\n}\n\n// The emulated OES_vertex_array_object **weblg extension**\nclass OESVertexArrayObject {\n  constructor(gl) {\n    this.gl = gl;\n\n    wrapGLError(gl);\n\n    this._polyfillWebGLRenderingContext(gl);\n  }\n\n  get VERTEX_ARRAY_BINDING_OES() {\n    return GL_VERTEX_ARRAY_BINDING;\n  }\n\n  createVertexArrayOES() {\n    const arrayObject = new WebGLVertexArrayObjectOES(this);\n    this.vertexArrayObjects.push(arrayObject);\n    return arrayObject;\n  }\n\n  deleteVertexArrayOES(arrayObject) {\n    arrayObject.isAlive = false;\n    this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(arrayObject), 1);\n    if (this.currentVertexArrayObject === arrayObject) {\n      this.bindVertexArrayOES(null);\n    }\n  }\n\n  isVertexArrayOES(arrayObject) {\n    if (arrayObject && arrayObject instanceof WebGLVertexArrayObjectOES) {\n      if (arrayObject.hasBeenBound && arrayObject.ext === this) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /* eslint-disable max-statements, complexity, max-depth */\n  bindVertexArrayOES(arrayObject) {\n    const gl = this.gl;\n    if (arrayObject && !arrayObject.isAlive) {\n      synthesizeGLError(gl.INVALID_OPERATION,\n        'bindVertexArrayOES: attempt to bind deleted arrayObject');\n      return;\n    }\n    const original = this.original;\n\n    const oldVAO = this.currentVertexArrayObject;\n    this.currentVertexArrayObject = arrayObject || this.defaultVertexArrayObject;\n    this.currentVertexArrayObject.hasBeenBound = true;\n    const newVAO = this.currentVertexArrayObject;\n\n    if (oldVAO === newVAO) {\n      return;\n    }\n\n    if (!oldVAO || newVAO.elementArrayBuffer !== oldVAO.elementArrayBuffer) {\n      original.bindBuffer.call(gl, gl.ELEMENT_ARRAY_BUFFER, newVAO.elementArrayBuffer);\n    }\n\n    let currentBinding = this.currentArrayBuffer;\n    const maxAttrib = Math.max(oldVAO ? oldVAO.maxAttrib : 0, newVAO.maxAttrib);\n    for (let n = 0; n <= maxAttrib; n++) {\n      const attrib = newVAO.attribs[n];\n      const oldAttrib = oldVAO ? oldVAO.attribs[n] : null;\n\n      if (!oldVAO || attrib.enabled !== oldAttrib.enabled) {\n        if (attrib.enabled) {\n          original.enableVertexAttribArray.call(gl, n);\n        } else {\n          original.disableVertexAttribArray.call(gl, n);\n        }\n      }\n\n      if (attrib.enabled) {\n        let bufferChanged = false;\n        if (!oldVAO || attrib.buffer !== oldAttrib.buffer) {\n          if (currentBinding !== attrib.buffer) {\n            original.bindBuffer.call(gl, gl.ARRAY_BUFFER, attrib.buffer);\n            currentBinding = attrib.buffer;\n          }\n          bufferChanged = true;\n        }\n\n        if (bufferChanged || attrib.cached !== oldAttrib.cached) {\n          original.vertexAttribPointer.call(\n            gl, n, attrib.size, attrib.type, attrib.normalized, attrib.stride, attrib.offset);\n        }\n      }\n    }\n\n    if (this.currentArrayBuffer !== currentBinding) {\n      original.bindBuffer.call(gl, gl.ARRAY_BUFFER, this.currentArrayBuffer);\n    }\n  }\n  /* eslint-enable max-statements, complexity, max-depth */\n\n  _polyfillWebGLRenderingContext(gl) {\n\n    const original = this.original = {\n      getParameter: gl.getParameter,\n      enableVertexAttribArray: gl.enableVertexAttribArray,\n      disableVertexAttribArray: gl.disableVertexAttribArray,\n      bindBuffer: gl.bindBuffer,\n      getVertexAttrib: gl.getVertexAttrib,\n      vertexAttribPointer: gl.vertexAttribPointer\n    };\n\n    const self = this;\n\n    Object.assign(gl, {\n      getParameter(pname) {\n        if (pname === self.VERTEX_ARRAY_BINDING_OES) {\n          return self.currentVertexArrayObject === self.defaultVertexArrayObject ?\n            null :\n            self.currentVertexArrayObject;\n        }\n        return original.getParameter.apply(this, arguments);\n      },\n\n      enableVertexAttribArray(index) {\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, index);\n        const attrib = vao.attribs[index];\n        attrib.enabled = true;\n        return original.enableVertexAttribArray.apply(this, arguments);\n      },\n\n      disableVertexAttribArray(index) {\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, index);\n        const attrib = vao.attribs[index];\n        attrib.enabled = false;\n        return original.disableVertexAttribArray.apply(this, arguments);\n      },\n\n      bindBuffer(target, buffer) {\n        switch (target) {\n        case gl.ARRAY_BUFFER:\n          self.currentArrayBuffer = buffer;\n          break;\n        case gl.ELEMENT_ARRAY_BUFFER:\n          self.currentVertexArrayObject.elementArrayBuffer = buffer;\n          break;\n        default:\n          throw new Error();\n        }\n        return original.bindBuffer.apply(this, arguments);\n      },\n\n      getVertexAttrib(index, pname) {\n        const vao = self.currentVertexArrayObject;\n        const attrib = vao.attribs[index];\n        switch (pname) {\n        case gl.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:\n          return attrib.buffer;\n        case gl.VERTEX_ATTRIB_ARRAY_ENABLED:\n          return attrib.enabled;\n        case gl.VERTEX_ATTRIB_ARRAY_SIZE:\n          return attrib.size;\n        case gl.VERTEX_ATTRIB_ARRAY_STRIDE:\n          return attrib.stride;\n        case gl.VERTEX_ATTRIB_ARRAY_TYPE:\n          return attrib.type;\n        case gl.VERTEX_ATTRIB_ARRAY_NORMALIZED:\n          return attrib.normalized;\n        default:\n          return original.getVertexAttrib.apply(this, arguments);\n        }\n      },\n\n      /* eslint-disable max-params */\n      vertexAttribPointer(indx, size, type, normalized, stride, offset) {\n      /* eslint-enable max-params */\n        const vao = self.currentVertexArrayObject;\n        vao.maxAttrib = Math.max(vao.maxAttrib, indx);\n        const attrib = vao.attribs[indx];\n        attrib.buffer = self.currentArrayBuffer;\n        attrib.size = size;\n        attrib.type = type;\n        attrib.normalized = normalized;\n        attrib.stride = stride;\n        attrib.offset = offset;\n        attrib.recache();\n        return original.vertexAttribPointer.apply(this, arguments);\n      }\n    });\n\n    if (gl.instrumentExtension) {\n      gl.instrumentExtension(this, OES_vertex_array_object);\n    }\n\n    // Note: gl.canvas is not available in headless gl\n    if (gl.canvas) {\n      gl.canvas.addEventListener('webglcontextrestored', function() {\n        console.debug('OESVertexArrayObject emulation library context restored');\n        self._reset();\n      }, true);\n    }\n\n    this._reset();\n  }\n\n  _reset() {\n    const contextWasLost = this.vertexArrayObjects !== undefined;\n    if (contextWasLost) {\n      for (let ii = 0; ii < this.vertexArrayObjects.length; ++ii) {\n        this.vertexArrayObjects.isAlive = false;\n      }\n    }\n    const gl = this.gl;\n    this.maxVertexAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n\n    this.defaultVertexArrayObject = new WebGLVertexArrayObjectOES(this);\n    this.currentVertexArrayObject = null;\n    this.currentArrayBuffer = null;\n    this.vertexArrayObjects = [this.defaultVertexArrayObject];\n\n    this.bindVertexArrayOES(null);\n  }\n}\n\n// ERROR emulation\n\nconst glErrorShadow = {};\n\nfunction synthesizeGLError(err, optionalMessage) {\n  glErrorShadow[err] = true;\n  if (optionalMessage !== undefined) {\n    console.error(optionalMessage);\n  }\n}\n\nfunction wrapGLError(gl) {\n  const originalFunc = gl.getError;\n  Object.assign(gl, {\n    getError() {\n      let err;\n      do {\n        err = originalFunc.apply(gl);\n        if (err !== gl.NO_ERROR) {\n          glErrorShadow[err] = true;\n        }\n      } while (err !== gl.NO_ERROR);\n\n      for (err in glErrorShadow) {\n        if (glErrorShadow[err]) {\n          delete glErrorShadow[err];\n          return parseInt(err, 10);\n        }\n      }\n      return gl.NO_ERROR;\n    }\n  });\n}\n\n// Install polyfill as extension\nexport default function polyfillVertexArrayObject(WebGLRenderingContext, gl) {\n  // 1) WebGL2 supports VertexArrayObjects by default, so return\n  // 2) If already installed, VERTEX_ARRAY_BINDING is defined\n  const isWebGL2 = WebGLRenderingContext.VERTEX_ARRAY_BINDING === GL_VERTEX_ARRAY_BINDING;\n  if (isWebGL2) {\n    return;\n  }\n\n  const originalMethods = {};\n\n  const POLYFILL_METHODS = {\n    // TODO - not per extension spec\n    VERTEX_ARRAY_BINDING: GL_VERTEX_ARRAY_BINDING,\n\n    getSupportedExtensions() {\n      const list = originalMethods.getSupportedExtensions.call(this) || [];\n      if (list.indexOf(OES_vertex_array_object) < 0) {\n        list.push(OES_vertex_array_object);\n      }\n      return list;\n    },\n\n    getExtension(name) {\n      const ext = originalMethods.getExtension.call(this, name);\n      if (ext) {\n        return ext;\n      }\n      if (name !== OES_vertex_array_object) {\n        return null;\n      }\n\n      if (!this.__OESVertexArrayObject) {\n        // console.debug('Setup OES_vertex_array_object polyfill');\n        this.__OESVertexArrayObject = new OESVertexArrayObject(this);\n      }\n      return this.__OESVertexArrayObject;\n    }\n  };\n\n  // Prefer polyfilling on prototype, however headless gl defines methods on context instance.\n  const contextUsesPrototype = Boolean(WebGLRenderingContext.prototype.getExtension);\n  const polyfillContext = contextUsesPrototype ? WebGLRenderingContext.prototype : gl;\n  Object.assign(originalMethods, {\n    getSupportedExtensions: polyfillContext.getSupportedExtensions,\n    getExtension: polyfillContext.getExtension\n  });\n\n  // Add polyfills, either once on prototype, or on each context if needed\n  if (contextUsesPrototype) {\n    if (WebGLRenderingContext.prototype.getExtension !== POLYFILL_METHODS.getExtension) {\n      Object.assign(WebGLRenderingContext.prototype, POLYFILL_METHODS);\n    }\n  } else {\n    Object.assign(gl, POLYFILL_METHODS);\n  }\n}\n"],"file":"polyfill-vertex-array-object.js"}