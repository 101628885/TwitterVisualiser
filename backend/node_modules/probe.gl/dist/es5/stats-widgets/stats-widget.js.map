{"version":3,"sources":["../../../src/stats-widgets/stats-widget.js"],"names":["TEXT_SIZE","TEXT_START","TEXT_SPACING","HEADER_SIZE","BOTTOM_SPACING","HEADER_POS","BG","FG","WIDTH","HEIGHT","items","length","StatsWidget","prevGpuTimes","i","totalTime","N","totalFrameTime","frameTimeCount","avgFrameTime","deltaTime","_clearTextArea","drawCalls","drawCall","frameTime","stats","gpuTime","pr","Math","round","window","devicePixelRatio","container","document","createElement","style","cssText","canvas","context","getContext","width","height","fillStyle","fillRect","appendChild","body","font","textBaseline","fillText","title","value","textCursor","str"],"mappings":"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","sourcesContent":["// Built on https://github.com/Erkaman/regl-stats-widget (MIT license)\n\n// widget styling constants.\nconst TEXT_SIZE = 10;\nconst TEXT_START = [7, 37];\nconst TEXT_SPACING = 6;\nconst HEADER_SIZE = 20;\nconst BOTTOM_SPACING = 20\nconst HEADER_POS = [3, 3];\nconst BG = '#000';\nconst FG = '#ccc';\n\nconst WIDTH = 160;\nconst HEIGHT = items =>\n  items.length * TEXT_SIZE +\n  (items.length - 1) * TEXT_SPACING +\n  TEXT_START[1] +\n  BOTTOM_SPACING;\n\n\nclass StatsWidget {\n\n  constructor(items) {\n    // the widget keeps track of the previous values of gpuTime,\n    // in order to compute the frame time.\n    const prevGpuTimes = []\n    for (let i = 0; i < items.length; i++) {\n      prevGpuTimes[i] = 0\n    }\n\n    // we update the widget every second, we need to keep track of the time:\n    const totalTime = 1.1\n\n    // we show the average frametime to the user.\n    const N = 50\n    const totalFrameTime = []\n    const frameTimeCount = 0\n    const avgFrameTime = []\n    for (i = 0; i < items.length; ++i) {\n      totalFrameTime[i] = 0.0\n      avgFrameTime[i] = 0.0\n    }\n  }\n\n  update(deltaTime) {\n    totalTime += deltaTime\n    if (totalTime > 1.0) {\n      totalTime = 0\n\n\n      // make sure that we clear the old text before drawing new text.\n      _clearTextArea();\n\n      // const frameTime;\n      // for (let i = 0; i < drawCalls.length; i++) {\n      //   const drawCall = drawCalls[i];\n\n      //   this._drawTextItem(context, i, drawCalls[i], avgFrameTime[i]);\n    }\n\n    frameTimeCount++\n    // make sure to update the previous gpuTime, and to compute the average.\n    for (i = 0; i < drawCalls.length; i++) {\n      drawCall = drawCalls[i];\n\n      frameTime = drawCall[0].stats.gpuTime - prevGpuTimes[i];\n      totalFrameTime[i] += frameTime;\n\n      if (frameTimeCount === N) {\n        avgFrameTime[i] = totalFrameTime[i] / N;\n        totalFrameTime[i] = 0.0;\n      }\n\n      prevGpuTimes[i] = drawCall[0].stats.gpuTime;\n    }\n\n    // reset avg calculation.\n    if (frameTimeCount === N) {\n      frameTimeCount = 0;\n    }\n  }\n\n  _createDOM() {\n    const pr = Math.round(window.devicePixelRatio || 1);\n\n    // the widget is contained in a <div>\n    const container = document.createElement('div');\n    container.style.cssText = 'position:fixed;top:20px;left:20px;opacity:0.8;z-index:10000;';\n\n    // we draw the widget on a canvas.\n    const canvas = document.createElement('canvas');\n\n    const context = canvas.getContext('2d');\n\n    // set canvas size\n    canvas.width = WIDTH * pr;\n    canvas.height = HEIGHT * pr;\n    canvas.style.cssText = `width: ${WIDTH}px;height: ${HEIGHT}px`;\n\n    // draw background.\n    context.fillStyle = BG;\n    context.fillRect(0, 0, WIDTH * pr, HEIGHT * pr);\n\n    container.appendChild(canvas);\n    document.body.appendChild(container);\n\n    this.context = context;\n  }\n\n  _drawHeader(context) {\n    const pr = Math.round(window.devicePixelRatio || 1);\n    context.font = `bold ${HEADER_SIZE * pr}px Helvetica,Arial,sans-serif`;\n    context.textBaseline = 'top';\n    context.fillStyle = FG;\n    context.fillText('Stats', HEADER_POS[0] * pr, HEADER_POS[1] * pr);\n  }\n\n  _clearTextArea(context) {\n    const pr = Math.round(window.devicePixelRatio || 1);\n    context.fillStyle = BG;\n    context.fillRect(\n      TEXT_START[0] * pr,\n      TEXT_START[1] * pr,\n      (WIDTH - TEXT_START[0]) * pr,\n      (HEIGHT - TEXT_START[1]) * pr\n    );\n    context.font = `bold ${TEXT_SIZE * pr}px Helvetica,Arial,sans-serif`;\n    context.fillStyle = FG;\n  }\n\n  _drawTextItem(context, i, title, value) {\n    const pr = Math.round(window.devicePixelRatio || 1);\n    // context, i, drawCalls[i], avgFrameTime[i]);\n    const textCursor = [TEXT_START[0], TEXT_START[1]];\n    const str = `${drawCall[1]} : ${Math.round(100.0 * avgFrameTime[i]) / 100.0}ms`\n    context.fillText(str, textCursor[0] * pr, textCursor[1] * pr)\n\n    // next line\n    textCursor[1] += TEXT_SIZE + TEXT_SPACING\n  }\n}\n"],"file":"stats-widget.js"}